<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Dashboard • Quick Work</title>
  <link rel="stylesheet" href="style.css">
  <script type="module">
    import { supabase } from './supabase.js'

    async function exchangeIfNeeded() {
      // Magic Link/OTP से आने पर URL में कोड होगा — इसे session में बदलना जरूरी
      const { error } = await supabase.auth.exchangeCodeForSession(window.location.href)
      // error हो तो भी ignore — हो सकता है सीधे आए हों
      // URL साफ़ कर दें
      if (window.location.search || window.location.hash) {
        history.replaceState({}, document.title, 'dashboard.html')
      }
    }

    async function requireAuth() {
      await exchangeIfNeeded()
      const { data: { session } } = await supabase.auth.getSession()
      if (!session) {
        location.href = 'login.html'
        return
      }
      // UI fill
      document.getElementById('email').textContent = session.user.email
    }

    window.addEventListener('DOMContentLoaded', async () => {
      await requireAuth()

      document.getElementById('logout').addEventListener('click', async () => {
        await supabase.auth.signOut()
        location.href = 'login.html'
      })
    })
  </script>
</head>
<body>
  <div class="container">
    <div class="card">
      <h2>Welcome to Dashboard</h2>
      <p class="msg">Logged in as: <strong id="email">…</strong></p>
      <button id="logout">Logout</button>
    </div>
  </div>
</body>
</html>
